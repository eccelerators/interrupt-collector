<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1. Interrupt Collector &#8212; eccelerators-sphinx-sample-configuration  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=e491ac2d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Interrupt Collector Interface (InterruptCollectorIfc)" href="Eccelerators.Library.IP.InterruptCollectorIfc-composite.html" />
    <link rel="prev" title="Welcome to InterruptCollector’s documentation!" href="index.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>eccelerators-sphinx-sample-configuration  documentation</span></a></h1>
        <h2 class="heading"><span>1. Interrupt Collector</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Welcome to InterruptCollector’s documentation!</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Eccelerators.Library.IP.InterruptCollectorIfc-composite.html"><span class="section-number">2. </span>Interrupt Collector Interface (InterruptCollectorIfc)</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="interrupt-collector">
<h1><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">1. </span>Interrupt Collector</a><a class="headerlink" href="#interrupt-collector" title="Link to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#interrupt-collector" id="id15">Interrupt Collector</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id16">Introduction</a></p></li>
<li><p><a class="reference internal" href="#testbench" id="id17">Testbench</a></p></li>
<li><p><a class="reference internal" href="#function-dut" id="id18">Function (DUT)</a></p></li>
<li><p><a class="reference internal" href="#quick-start-simulation" id="id19">Quick Start Simulation</a></p></li>
<li><p><a class="reference internal" href="#ghdl-linux" id="id20">GHDL Linux</a></p></li>
<li><p><a class="reference internal" href="#ghdl-windows" id="id21">GHDL Windows</a></p></li>
<li><p><a class="reference internal" href="#modelsim" id="id22">ModelSim</a></p></li>
<li><p><a class="reference internal" href="#hxs-hardware-software-interface" id="id23">HxS - Hardware/Software interface</a></p></li>
<li><p><a class="reference internal" href="#docbook-customizations" id="id24">DocBook customizations</a></p></li>
<li><p><a class="reference internal" href="#further-steps" id="id25">Further steps</a></p></li>
<li><p><a class="reference internal" href="#install-ghdl-ubuntu-22-04" id="id26">Install GHDL Ubuntu 22.04</a></p></li>
<li><p><a class="reference internal" href="#install-ghdl-windows" id="id27">Install GHDL Windows</a></p></li>
<li><p><a class="reference internal" href="#python" id="id28">Python</a></p></li>
<li><p><a class="reference internal" href="#adapt-ant-build" id="id29">Adapt ANT build</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>This README is a partial view of the final documents:</p>
<p>PDF <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/src-gen/docbook-pdf/Eccelerators.Library.IP.InterruptCollectorIfc.pdf">InterruptCollectorIfc.pdf</a>
HTML <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/src-gen/sphinx-html/index.html">InterruptCollectorIfc.pdf</a></p>
<section id="introduction">
<h2><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">1.1. </span>Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Interrupts connect software (SW) and hardware (HW) very closely. They require a carefully planned concept that starts from the HW source bit, which
causes an interrupt event, through different HW controllers/collectors located both outside and inside a CPU system, and extends to
the SW operating system and its drivers, up to the application software. The concept is dependent on the specific nature of all components
in this chain and dramatically affects the real-time capabilities and overall performance of a system.</p>
<p>A designer of a peripheral logic block for a CPU system is often required to issue an interrupt to the system if their logic needs attention from the CPU.
Typically, there is more than one event source in the peripheral logic block that can trigger an interrupt.
The <em>Interrupt-Collector</em> presented here is a proven solution for managing these tasks. It does not impose excessive overhead on a peripheral logic block
for a tiny microcontroller and is suitable for the most complex systems on a chip (SOC) with multiple cores running in symmetric or asymmetric multiprocessing mode.
Thus, it and its driver software can be reused across a wide range of designs.</p>
<p>The description of the <em>Interrupt-Collector</em> in the subsequent chapters is structured in a top-down manner, starting from a testbench that includes it,
and progressing to its internal functions.</p>
<p>The testbench simulation can be run immediately with either the GHDL or ModelSim simulator using the included ANT scripts. For more information,
see the <a class="reference internal" href="#quick-start-simlation"><span class="std std-ref">Quick Start Simulation</span></a> section.</p>
<p>The VHDL source code, along with other source code in this repository, can be used liberally under the MIT license for any design.</p>
</section>
<section id="testbench">
<h2><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">1.2. </span>Testbench</a><a class="headerlink" href="#testbench" title="Link to this heading">¶</a></h2>
<figure class="align-default" id="id11">
<img alt="_images/InterruptCollectorTestbench.png" src="_images/InterruptCollectorTestbench.png" />
<figcaption>
<p><span class="caption-text">Interrupt Collector Testbench</span><a class="headerlink" href="#id11" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The “Interrupt Collector Testbench” illustrates the Device Under Test (DUT)—our Interrupt Collector—within a red-bordered block. On the left, there are
two processors, simulating a multiprocessor system. Each processor is an instance of the <a class="reference external" href="https://github.com/eccelerators/simstm">Eccelerators SimStm Testbench</a>.
These processors are augmented by a BusJoin unit, which forms the common bus connection for the Dual Core Processor system, and an InterruptDispatcher unit
that dispatches arriving interrupts to one of the cores.
Both cores execute the same SimStm code, as shown on the left. The main routine is differentiated based on the core number; Processor 0 is responsible for managing initial
processes and cross-run signals for Processor 1. It is only Processor 0 that performs the initialization of the DUT and MOCK.</p>
<p>A short glance at the SimStm program “Main” routine snippet, the corresponding source file is <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/tb/simstm/testMain.stm">testMain.stm</a> .</p>
<figure class="align-default" id="id12">
<img alt="_images/simstm-snippet.png" src="_images/simstm-snippet.png" />
<figcaption>
<p><span class="caption-text">SimStm Main Routine Snippet</span><a class="headerlink" href="#id12" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The SimStm source code is very compact and easy readable. It starts with the declaration and definition of constants, variables signals and buses. Following is the
‘testMain’ procedure, then the Interrupt procedure and helper procedures.</p>
<p>A BusDivider unit, generated by HxS, features two delegates. It splits the bus into two separate buses, each designated for different address
areas: one for the Device Under Test (DUT) and another for the MOCK.</p>
<p>The MOCK includes an interrupt generator with four channels. These channels are designed to generate a charged number of interrupts at programmable intervals
repeatedly. For each interrupt, acknowledgment is required from the software interrupt service routine within the corresponding channel of the generator.
This acknowledgment process involves reading the actual count from a register and then writing this count to a reference count register.
Any missed or incorrect acknowledgments are logged for each issued interrupt in a failure count register. Should any channel experience a fault,
the generator signals this failure through its “GeneratorFailure” output at the first occurrence of such a fault.</p>
<p>The four interrupts generated by the Interrupt Generator are processed by the Device Under Test (DUT), the Interrupt Collector. They are delivered to the
Dual Core Processor system via its “OutUpInterrupt” output.</p>
<p>The running simulation of the testbench should demonstrate that all generated interrupts are serviced in parallel, with the services being
evenly distributed between both cores.</p>
</section>
<section id="function-dut">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">1.3. </span>Function (DUT)</a><a class="headerlink" href="#function-dut" title="Link to this heading">¶</a></h2>
<p>The interrupt collector consists of two parts. The first part, the hardware-software interface, is generated by the Eccelerators Tool HxS.
It uses the description of the Mask-, Service- and Request, Registers in the HxS language as input. The output is the complete implementation
of these registers in VHDL connected to a Wishbone Bus, with the necessary inputs and outputs to a user logic block.
The second part contains the logic of the interrupt collector function, coded by the user Eccelerators.</p>
<p>The design allows for the simultaneous processing of different interrupts within the same interrupt collector by multiple
processors of a multiprocessor system, without the need for additional synchronization measures such as Spin-Locks.</p>
<p>The accompanying diagram illustrates the implementation, including the connection of the HxS block to a Wishbone bus leading
to the CPU or the multiprocessor system. The User Block demonstrates the realization of the interrupt logic.
Both blocks are scalable in terms of the number of serviced interrupt inputs.</p>
<figure class="align-default" id="id13">
<a class="reference internal image-reference" href="_images/InterruptCollectorOverview.png"><img alt="_images/InterruptCollectorOverview.png" src="_images/InterruptCollectorOverview.png" style="width: 1559.0px; height: 939.0px;" /></a>
<figcaption>
<p><span class="caption-text">Interrupt Collector Overview</span><a class="headerlink" href="#id13" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Upon the arrival of an interrupt event at an input, an interrupt is triggered to the CPU system.
This leads to the execution of an interrupt routine by software on exactly one CPU of the system. The routine reads the <em>Request-Register</em>
in the interrupt collector, selects one of the reported interrupt requests for processing, and acknowledges
this by setting the corresponding bit in the Request-Register.
This interrupt request is then reset in the Request-Register and appears in the <em>Service-Register</em>. After completing the tasks in the interrupt
service routine, the CPU sets to the corresponding bit in the Service-Register, thereby signaling the end of the interrupt routine
to the interrupt collector. Only from this point can the corresponding Request-Register bit be set again by the same interrupt input.</p>
<p>The actual triggering of an interrupt to the CPU system can be enabled or disabled in the <em>Mask-Register</em> for each input.
After each acknowledged request, the interrupt line to the CPU system is briefly deactivated to allow for the processing
of further interrupts by other CPUs of the system.</p>
<p>The sources for the Interrupt-Collector inputs must have a level-triggering nature. The source logic block issuing an interrupt event must keep its signal active
until it is acknowledged by the interrupt service routine by some SW access to the source logic block.</p>
<p>Edge-triggering sources e.g., timers must be converted to level-triggering sources. A solution for this conversion is the
the <a class="reference external" href="https://github.com/eccelerators/event-catcher">event-catcher</a> IP.</p>
</section>
<section id="quick-start-simulation">
<span id="quick-start-simlation"></span><h2><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">1.4. </span>Quick Start Simulation</a><a class="headerlink" href="#quick-start-simulation" title="Link to this heading">¶</a></h2>
</section>
<section id="ghdl-linux">
<h2><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">1.5. </span>GHDL Linux</a><a class="headerlink" href="#ghdl-linux" title="Link to this heading">¶</a></h2>
<p>We use Ubuntu 22.04 for demonstration.</p>
<p>At least a java runtime &gt;= 17 is required. If not already present e.g., install it by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">openjdk</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">jre</span>
</pre></div>
</div>
<p>All builds are run by means of <a class="reference external" href="https://ant.apache.org/">APACHE ANT</a> and respective build.xml files.
If not already present e.g., install it by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ant</span>
</pre></div>
</div>
<p>Git is required to clone the interrupt-collector repository.
If not already present e.g., install it by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">git</span>
</pre></div>
</div>
<p>Next, we clone the actual <a class="reference external" href="https://github.com/eccelerators/interrupt-collector">interrupt-collector</a>
repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">eccelerators</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>The  <code class="docutils literal notranslate"><span class="pre">--recursive</span></code> parameter is mandatory because many resources e.g. child build.xml files are residing there.</p>
<p>In an unconventional approach, all necessary artifacts generated by previously executed build steps in the Ecclerators IP project workflow are already
present in the cloned working copy. This setup facilitates easy use and progress with this starter IP.</p>
<p>To run the simulation with GHDL its version 4.0.0 must be present.</p>
<p>If not jump to <a class="reference internal" href="#install-ghdl-ubuntu-22-04"><span class="std std-ref">Install GHDL Ubuntu 22.04</span></a> section, if not callable as ‘ghdl’ in path, usually wit Windows, jump to <a class="reference internal" href="#adapt-ant-build"><span class="std std-ref">Adapt ANT build</span></a>.</p>
<p>Then simulation can be run, assuming the cloned repository is located in ‘git/interrupt-collector’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>This should result in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[exec] Core0: Main test started
[exec] Core1: Cross notify interrupt happened
[exec] Core1: test started
[exec] Core0: Cross notify interrupt happened
[exec] Core1 currently: Interrupts in total: 32, Source0: 12, Source1: 6, Source2: 6, Source3: 8
[exec] Core0 currently: Interrupts in total: 32, Source0: 13, Source1: 11, Source2: 6, Source3: 2
[exec] Core1 currently: Interrupts in total: 64, Source0: 22, Source1: 14, Source2: 12, Source3: 16
[exec] Core0 currently: Interrupts in total: 64, Source0: 28, Source1: 21, Source2: 12, Source3: 3
[exec] Core1 currently: Interrupts in total: 96, Source0: 34, Source1: 19, Source2: 20, Source3: 23
[exec] Core0 currently: Interrupts in total: 96, Source0: 43, Source1: 30, Source2: 18, Source3: 5
[exec] Core1 currently: Interrupts in total: 128, Source0: 46, Source1: 25, Source2: 25, Source3: 32
[exec] Core0 currently: Interrupts in total: 128, Source0: 56, Source1: 41, Source2: 24, Source3: 7
[exec] Core1 currently: Interrupts in total: 160, Source0: 56, Source1: 32, Source2: 32, Source3: 40
[exec] Core0 currently: Interrupts in total: 160, Source0: 69, Source1: 52, Source2: 30, Source3: 9
[exec] Core1 currently: Interrupts in total: 192, Source0: 68, Source1: 38, Source2: 38, Source3: 48
[exec] Core0 currently: Interrupts in total: 192, Source0: 84, Source1: 62, Source2: 36, Source3: 10
[exec] Core1 currently: Interrupts in total: 224, Source0: 78, Source1: 46, Source2: 44, Source3: 56
[exec] Core0 currently: Interrupts in total: 224, Source0: 98, Source1: 72, Source2: 42, Source3: 12
[exec] Core1 currently: Interrupts in total: 256, Source0: 90, Source1: 51, Source2: 52, Source3: 63
[exec] Core0 currently: Interrupts in total: 256, Source0: 110, Source1: 84, Source2: 48, Source3: 14
[exec] Core1 currently: Interrupts in total: 288, Source0: 102, Source1: 57, Source2: 57, Source3: 72
[exec] Core0 currently: Interrupts in total: 288, Source0: 125, Source1: 93, Source2: 54, Source3: 16
[exec] Core1 currently: Interrupts in total: 320, Source0: 112, Source1: 64, Source2: 64, Source3: 80
[exec] Core0 currently: Interrupts in total: 320, Source0: 139, Source1: 103, Source2: 61, Source3: 17
[exec] Core1 currently: Interrupts in total: 352, Source0: 124, Source1: 70, Source2: 70, Source3: 88
[exec] Core0 currently: Interrupts in total: 352, Source0: 153, Source1: 113, Source2: 67, Source3: 19
[exec] Core1 currently: Interrupts in total: 384, Source0: 134, Source1: 78, Source2: 76, Source3: 96
[exec] Core0 currently: Interrupts in total: 384, Source0: 166, Source1: 125, Source2: 72, Source3: 21
[exec] Core1 currently: Interrupts in total: 416, Source0: 146, Source1: 83, Source2: 84, Source3: 103
[exec] Core0 currently: Interrupts in total: 416, Source0: 180, Source1: 135, Source2: 79, Source3: 22
[exec] Core1 currently: Interrupts in total: 448, Source0: 158, Source1: 89, Source2: 89, Source3: 112
[exec] Core1 currently: Interrupts in total: 480, Source0: 168, Source1: 96, Source2: 96, Source3: 120
[exec] Core0 currently: Interrupts in total: 448, Source0: 195, Source1: 144, Source2: 85, Source3: 24
[exec] Core1 currently: Interrupts in total: 512, Source0: 180, Source1: 102, Source2: 102, Source3: 128
[exec] Core0 currently: Interrupts in total: 480, Source0: 207, Source1: 156, Source2: 91, Source3: 26
[exec] Core1 currently: Interrupts in total: 544, Source0: 190, Source1: 110, Source2: 108, Source3: 136
[exec] Core0 currently: Interrupts in total: 512, Source0: 221, Source1: 166, Source2: 97, Source3: 28
[exec] Core1 currently: Interrupts in total: 576, Source0: 202, Source1: 115, Source2: 116, Source3: 143
[exec] Core0 currently: Interrupts in total: 544, Source0: 236, Source1: 176, Source2: 103, Source3: 29
[exec] Core1 currently: Interrupts in total: 608, Source0: 214, Source1: 121, Source2: 121, Source3: 152
[exec] Core0 currently: Interrupts in total: 576, Source0: 251, Source1: 185, Source2: 109, Source3: 31
[exec] Core1 currently: Interrupts in total: 640, Source0: 224, Source1: 128, Source2: 128, Source3: 160
[exec] Core0 currently: Interrupts in total: 608, Source0: 264, Source1: 197, Source2: 114, Source3: 33
[exec] Core1 currently: Interrupts in total: 672, Source0: 236, Source1: 134, Source2: 134, Source3: 168
[exec] Core0 currently: Interrupts in total: 640, Source0: 276, Source1: 208, Source2: 121, Source3: 35
[exec] Core1 currently: Interrupts in total: 704, Source0: 246, Source1: 142, Source2: 140, Source3: 176
[exec] Core0 currently: Interrupts in total: 672, Source0: 291, Source1: 218, Source2: 127, Source3: 36
[exec] Core1 currently: Interrupts in total: 736, Source0: 258, Source1: 147, Source2: 148, Source3: 183
[exec] Core0 currently: Interrupts in total: 704, Source0: 305, Source1: 228, Source2: 133, Source3: 38
[exec] Core1 currently: Interrupts in total: 768, Source0: 270, Source1: 153, Source2: 153, Source3: 192
[exec] Core0 currently: Interrupts in total: 736, Source0: 318, Source1: 239, Source2: 139, Source3: 40
[exec] Core1 currently: Interrupts in total: 800, Source0: 280, Source1: 160, Source2: 160, Source3: 200
[exec] Core0 currently: Interrupts in total: 768, Source0: 332, Source1: 249, Source2: 145, Source3: 42
[exec] Core1 currently: Interrupts in total: 832, Source0: 292, Source1: 166, Source2: 166, Source3: 208
[exec] Core0 currently: Interrupts in total: 800, Source0: 341, Source1: 260, Source2: 156, Source3: 43
[exec] Core1 currently: Interrupts in total: 864, Source0: 299, Source1: 181, Source2: 171, Source3: 213
[exec] Core0 currently: Interrupts in total: 832, Source0: 341, Source1: 268, Source2: 180, Source3: 43
[exec] Core1 currently: Interrupts in total: 896, Source0: 299, Source1: 213, Source2: 171, Source3: 213
[exec] Core0 currently: Interrupts in total: 864, Source0: 341, Source1: 276, Source2: 204, Source3: 43
[exec]
[exec] Core1 finally: Interrupts in total: 916, Source0: 299, Source1: 233, Source2: 171, Source3: 213
[exec] Core1: test finished
[exec]
[exec] Core0 finally: Interrupts in total: 876, Source0: 341, Source1: 279, Source2: 213, Source3: 43
[exec]
[exec] Total counts finally: ActualSum: 1792, Actual0: 640, Actual1: 512, Actual2: 384, Actual3: 256
[exec] Total failure count finally: FailureSum: 0, Failures0: 0, Failures1: 0, Failures2: 0, Failures3: 0
[exec]
[exec] Core0: Main test finished
[exec]
[exec] /home/heinrich/git/interrupt-collector/submodules/simstm/src/tb_simstm.vhd:1308:21:@773696100ps:(assertion note): test finished with no errors!!
[exec] /home/heinrich/git/interrupt-collector/simulation/ghdl-wishbone/work/tb_top_wishbone:info: simulation stopped by --stop-time @99992130300ps
</pre></div>
</div>
<p>Then simulation can be re-run then, since compilation and elaboration has already been done by the target ‘ghdl-wishbone-all’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span>
</pre></div>
</div>
<p><strong>This is very useful since the SimStm (.stm) stimuli files can be changed to do a new simulation WITHOUT recompilation.</strong></p>
<p>Then simulation can be re-run with GUI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">gui</span>
</pre></div>
</div>
<p>If the script complains about ‘gtkwave’ missing, see respective install section to install it.:</p>
<p><a class="reference internal" href="#install-ghdl-ubuntu-22-04"><span class="std std-ref">Install GHDL Ubuntu 22.04</span></a></p>
</section>
<section id="ghdl-windows">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">1.6. </span>GHDL Windows</a><a class="headerlink" href="#ghdl-windows" title="Link to this heading">¶</a></h2>
<p>We use Windows 10 for demonstration.</p>
<p>At least a java runtime &gt;= 17 is required. If not already present e.g., install it by downloading:</p>
<p><a class="reference external" href="https://aka.ms/download-jdk/microsoft-jdk-17.0.10-windows-x64.msi">JAVA</a></p>
<p>Git is required to clone the interrupt-collector repository.
If not already present e.g., by having already installed MSYS2 for GHDL install it in your favorite way.</p>
<p>Next, we clone the actual <a class="reference external" href="https://github.com/eccelerators/interrupt-collector">interrupt-collector</a>
repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">eccelerators</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>The  <code class="docutils literal notranslate"><span class="pre">--recursive</span></code> parameter is mandatory because many resources e.g. child build.xml files are residing there.</p>
<p>In an unconventional approach, all necessary artifacts generated by previously executed build steps in the Ecclerators IP project workflow are already
present in the cloned working copy. This setup facilitates easy use and progress with this starter IP.</p>
<p>All builds are run by means of <a class="reference external" href="https://ant.apache.org/">APACHE ANT</a> and respective build.xml files.
If not already present e.g., install it by downloading:</p>
<p><a class="reference external" href="https://downloads.apache.org/ant/binaries/apache-ant-1.10.14-bin.zip">ANT</a></p>
<p>Unzip it e.g., to C:/apache-ant-1.10.14-bin and add the bin folder to your path environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">git</span>\<span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span><span class="o">&gt;</span><span class="n">ant</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>should produce then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Buildfile</span><span class="p">:</span> <span class="n">c</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">git</span>\<span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>\<span class="n">build</span><span class="o">.</span><span class="n">xml</span>

<span class="n">Main</span> <span class="n">targets</span><span class="p">:</span>

 <span class="n">_helper</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">submodules</span>                            <span class="n">initially</span> <span class="n">add</span> <span class="nb">all</span> <span class="n">submodules</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">helper</span> <span class="n">add_submodules</span><span class="o">.</span><span class="n">py</span> <span class="nb">list</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">clean</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">totally</span>                     <span class="n">remove</span> <span class="nb">all</span> <span class="n">generated</span> <span class="n">folders</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">generate</span><span class="o">-</span><span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">ant</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">xml</span>      <span class="n">generate</span> <span class="n">ant</span> <span class="n">build</span> <span class="n">file</span> <span class="k">for</span> <span class="n">ghdl</span> <span class="n">wishbone</span> <span class="n">case</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">generate</span><span class="o">-</span><span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">ant</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">xml</span>  <span class="n">generate</span> <span class="n">ant</span> <span class="n">build</span> <span class="n">file</span> <span class="k">for</span> <span class="n">modelsim</span> <span class="n">wishbone</span> <span class="n">case</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">generate</span><span class="o">-</span><span class="n">proposal</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">setup</span><span class="o">-</span><span class="n">py</span>            <span class="n">generate</span> <span class="n">a</span> <span class="n">proposal</span> <span class="k">for</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">plausibility_check_of_setup_py</span>            <span class="n">check</span> <span class="n">plausibility</span> <span class="n">of</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">ghdl</span>                               <span class="n">remove</span> <span class="n">ghdl</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">modelsim</span>                           <span class="n">remove</span> <span class="n">modelsim</span>
 <span class="n">_helper</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">submodules</span>                         <span class="n">remove</span> <span class="nb">all</span> <span class="n">submodules</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">helper</span> <span class="n">remove_submodules</span><span class="o">.</span><span class="n">py</span> <span class="nb">list</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span>                                 <span class="nb">all</span> <span class="kn">from</span> <span class="nn">scratch</span> <span class="n">until</span> <span class="n">interactive</span> <span class="n">simulation</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">clean</span>                               <span class="n">delete</span> <span class="n">work</span> <span class="n">folder</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">compile</span>                             <span class="nb">compile</span> <span class="nb">all</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">elaborate</span>                           <span class="n">elaborate</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">prepare</span>                             <span class="n">make</span> <span class="n">work</span> <span class="n">folder</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span>                            <span class="n">run</span> <span class="n">simulation</span>
 <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">gui</span>                        <span class="n">simulate</span> <span class="ow">and</span> <span class="n">write</span> <span class="n">trace</span><span class="o">.</span><span class="n">vcd</span>
 <span class="n">hxs</span><span class="o">-</span><span class="nb">all</span>                                           <span class="nb">compile</span> <span class="nb">all</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">clean</span>                                         <span class="n">Delete</span> <span class="nb">all</span> <span class="n">previously</span> <span class="n">generated</span> <span class="n">result</span> <span class="n">files</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">docbook2html</span>                                  <span class="n">Generate</span> <span class="n">a</span> <span class="n">HTML5</span> <span class="n">file</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">docbook2pdf</span>                                   <span class="n">Generate</span> <span class="n">a</span> <span class="n">PDF</span> <span class="n">file</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">hxs2c</span>                                         <span class="n">Build</span> <span class="n">c</span> <span class="n">files</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">hxs2python</span>                                    <span class="n">Build</span> <span class="n">python</span> <span class="n">files</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">hxs2rst</span>                                       <span class="n">Build</span> <span class="n">rst</span> <span class="n">text</span> <span class="n">description</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">hxs2simstm</span>                                    <span class="n">Build</span> <span class="n">simstm</span> <span class="n">files</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">hxs2vhdl</span>                                      <span class="n">Build</span> <span class="n">vhdl</span> <span class="n">files</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">rst2docbook</span>                                   <span class="n">Build</span> <span class="n">docbook</span> <span class="n">description</span> <span class="kn">from</span> <span class="nn">rst</span> <span class="k">with</span> <span class="n">Sphinx</span>
 <span class="n">hxs</span><span class="o">-</span><span class="n">rst2html</span><span class="o">-</span><span class="n">sphinx</span>                               <span class="n">Build</span> <span class="n">html</span> <span class="n">description</span> <span class="kn">from</span> <span class="nn">rst</span> <span class="k">with</span> <span class="n">Sphinx</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span>                             <span class="nb">all</span> <span class="kn">from</span> <span class="nn">scratch</span> <span class="n">until</span> <span class="n">interactive</span> <span class="n">simulation</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">gui</span>                         <span class="nb">all</span> <span class="kn">from</span> <span class="nn">scratch</span> <span class="n">until</span> <span class="n">interactive</span> <span class="n">simulation</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">clean</span>                           <span class="n">delete</span> <span class="n">work</span> <span class="n">folder</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">compile</span>                         <span class="nb">compile</span> <span class="nb">all</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">prepare</span>                         <span class="n">make</span> <span class="n">work</span> <span class="n">folder</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span>                        <span class="n">simulate</span>
 <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">gui</span>                    <span class="n">simulate</span> <span class="n">start</span> <span class="n">gui</span>
</pre></div>
</div>
<p>To run the simulation with GHDL its version 4.0.0 must be present.</p>
<p>If not jump to <a class="reference internal" href="#install-ghdl-windows"><span class="std std-ref">Install GHDL Windows</span></a> section, if not callable as ‘ghdl’ in path, usually wit Windows, jump to <a class="reference internal" href="#adapt-ant-build"><span class="std std-ref">Adapt ANT build</span></a>.</p>
<p>Then simulation can be run, assuming the cloned repository is located in ‘git/interrupt-collector’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>This should result in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[exec] Core0: Main test started
[exec] Core1: Cross notify interrupt happened
[exec] Core1: test started
[exec] Core0: Cross notify interrupt happened
[exec] Core1 currently: Interrupts in total: 32, Source0: 12, Source1: 6, Source2: 6, Source3: 8
[exec] Core0 currently: Interrupts in total: 32, Source0: 13, Source1: 11, Source2: 6, Source3: 2
[exec] Core1 currently: Interrupts in total: 64, Source0: 22, Source1: 14, Source2: 12, Source3: 16
[exec] Core0 currently: Interrupts in total: 64, Source0: 28, Source1: 21, Source2: 12, Source3: 3
[exec] Core1 currently: Interrupts in total: 96, Source0: 34, Source1: 19, Source2: 20, Source3: 23
[exec] Core0 currently: Interrupts in total: 96, Source0: 43, Source1: 30, Source2: 18, Source3: 5
[exec] Core1 currently: Interrupts in total: 128, Source0: 46, Source1: 25, Source2: 25, Source3: 32
[exec] Core0 currently: Interrupts in total: 128, Source0: 56, Source1: 41, Source2: 24, Source3: 7
[exec] Core1 currently: Interrupts in total: 160, Source0: 56, Source1: 32, Source2: 32, Source3: 40
[exec] Core0 currently: Interrupts in total: 160, Source0: 69, Source1: 52, Source2: 30, Source3: 9
[exec] Core1 currently: Interrupts in total: 192, Source0: 68, Source1: 38, Source2: 38, Source3: 48
[exec] Core0 currently: Interrupts in total: 192, Source0: 84, Source1: 62, Source2: 36, Source3: 10
[exec] Core1 currently: Interrupts in total: 224, Source0: 78, Source1: 46, Source2: 44, Source3: 56
[exec] Core0 currently: Interrupts in total: 224, Source0: 98, Source1: 72, Source2: 42, Source3: 12
[exec] Core1 currently: Interrupts in total: 256, Source0: 90, Source1: 51, Source2: 52, Source3: 63
[exec] Core0 currently: Interrupts in total: 256, Source0: 110, Source1: 84, Source2: 48, Source3: 14
[exec] Core1 currently: Interrupts in total: 288, Source0: 102, Source1: 57, Source2: 57, Source3: 72
[exec] Core0 currently: Interrupts in total: 288, Source0: 125, Source1: 93, Source2: 54, Source3: 16
[exec] Core1 currently: Interrupts in total: 320, Source0: 112, Source1: 64, Source2: 64, Source3: 80
[exec] Core0 currently: Interrupts in total: 320, Source0: 139, Source1: 103, Source2: 61, Source3: 17
[exec] Core1 currently: Interrupts in total: 352, Source0: 124, Source1: 70, Source2: 70, Source3: 88
[exec] Core0 currently: Interrupts in total: 352, Source0: 153, Source1: 113, Source2: 67, Source3: 19
[exec] Core1 currently: Interrupts in total: 384, Source0: 134, Source1: 78, Source2: 76, Source3: 96
[exec] Core0 currently: Interrupts in total: 384, Source0: 166, Source1: 125, Source2: 72, Source3: 21
[exec] Core1 currently: Interrupts in total: 416, Source0: 146, Source1: 83, Source2: 84, Source3: 103
[exec] Core0 currently: Interrupts in total: 416, Source0: 180, Source1: 135, Source2: 79, Source3: 22
[exec] Core1 currently: Interrupts in total: 448, Source0: 158, Source1: 89, Source2: 89, Source3: 112
[exec] Core1 currently: Interrupts in total: 480, Source0: 168, Source1: 96, Source2: 96, Source3: 120
[exec] Core0 currently: Interrupts in total: 448, Source0: 195, Source1: 144, Source2: 85, Source3: 24
[exec] Core1 currently: Interrupts in total: 512, Source0: 180, Source1: 102, Source2: 102, Source3: 128
[exec] Core0 currently: Interrupts in total: 480, Source0: 207, Source1: 156, Source2: 91, Source3: 26
[exec] Core1 currently: Interrupts in total: 544, Source0: 190, Source1: 110, Source2: 108, Source3: 136
[exec] Core0 currently: Interrupts in total: 512, Source0: 221, Source1: 166, Source2: 97, Source3: 28
[exec] Core1 currently: Interrupts in total: 576, Source0: 202, Source1: 115, Source2: 116, Source3: 143
[exec] Core0 currently: Interrupts in total: 544, Source0: 236, Source1: 176, Source2: 103, Source3: 29
[exec] Core1 currently: Interrupts in total: 608, Source0: 214, Source1: 121, Source2: 121, Source3: 152
[exec] Core0 currently: Interrupts in total: 576, Source0: 251, Source1: 185, Source2: 109, Source3: 31
[exec] Core1 currently: Interrupts in total: 640, Source0: 224, Source1: 128, Source2: 128, Source3: 160
[exec] Core0 currently: Interrupts in total: 608, Source0: 264, Source1: 197, Source2: 114, Source3: 33
[exec] Core1 currently: Interrupts in total: 672, Source0: 236, Source1: 134, Source2: 134, Source3: 168
[exec] Core0 currently: Interrupts in total: 640, Source0: 276, Source1: 208, Source2: 121, Source3: 35
[exec] Core1 currently: Interrupts in total: 704, Source0: 246, Source1: 142, Source2: 140, Source3: 176
[exec] Core0 currently: Interrupts in total: 672, Source0: 291, Source1: 218, Source2: 127, Source3: 36
[exec] Core1 currently: Interrupts in total: 736, Source0: 258, Source1: 147, Source2: 148, Source3: 183
[exec] Core0 currently: Interrupts in total: 704, Source0: 305, Source1: 228, Source2: 133, Source3: 38
[exec] Core1 currently: Interrupts in total: 768, Source0: 270, Source1: 153, Source2: 153, Source3: 192
[exec] Core0 currently: Interrupts in total: 736, Source0: 318, Source1: 239, Source2: 139, Source3: 40
[exec] Core1 currently: Interrupts in total: 800, Source0: 280, Source1: 160, Source2: 160, Source3: 200
[exec] Core0 currently: Interrupts in total: 768, Source0: 332, Source1: 249, Source2: 145, Source3: 42
[exec] Core1 currently: Interrupts in total: 832, Source0: 292, Source1: 166, Source2: 166, Source3: 208
[exec] Core0 currently: Interrupts in total: 800, Source0: 341, Source1: 260, Source2: 156, Source3: 43
[exec] Core1 currently: Interrupts in total: 864, Source0: 299, Source1: 181, Source2: 171, Source3: 213
[exec] Core0 currently: Interrupts in total: 832, Source0: 341, Source1: 268, Source2: 180, Source3: 43
[exec] Core1 currently: Interrupts in total: 896, Source0: 299, Source1: 213, Source2: 171, Source3: 213
[exec] Core0 currently: Interrupts in total: 864, Source0: 341, Source1: 276, Source2: 204, Source3: 43
[exec]
[exec] Core1 finally: Interrupts in total: 916, Source0: 299, Source1: 233, Source2: 171, Source3: 213
[exec] Core1: test finished
[exec]
[exec] Core0 finally: Interrupts in total: 876, Source0: 341, Source1: 279, Source2: 213, Source3: 43
[exec]
[exec] Total counts finally: ActualSum: 1792, Actual0: 640, Actual1: 512, Actual2: 384, Actual3: 256
[exec] Total failure count finally: FailureSum: 0, Failures0: 0, Failures1: 0, Failures2: 0, Failures3: 0
[exec]
[exec] Core0: Main test finished
[exec]
[exec] /home/heinrich/git/interrupt-collector/submodules/simstm/src/tb_simstm.vhd:1308:21:@773696100ps:(assertion note): test finished with no errors!!
[exec] /home/heinrich/git/interrupt-collector/simulation/ghdl-wishbone/work/tb_top_wishbone:info: simulation stopped by --stop-time @99992130300ps
</pre></div>
</div>
<p>Then simulation can be re-run then, since compilation and elaboration has already been done by the target ‘ghdl-wishbone-all’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span>
</pre></div>
</div>
<p><strong>This is very useful since the SimStm (.stm) stimuli files can be changed to do a new simulation WITHOUT recompilation.</strong></p>
<p>Then simulation can be re-run with GUI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">gui</span>
</pre></div>
</div>
<p>If the script complains about ‘gtkwave’ missing, see respective install section to install it.:</p>
<p><a class="reference internal" href="#install-ghdl-windows"><span class="std std-ref">Install GHDL Windows</span></a></p>
</section>
<section id="modelsim">
<h2><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">1.7. </span>ModelSim</a><a class="headerlink" href="#modelsim" title="Link to this heading">¶</a></h2>
<p>Assuming ModelSim is already installed, to simulate the design we run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>Possibly the path to the ModelSim executable may have to be adapted in the ant build.xml file.</p>
<p>Using ModelSim Starter edition it may take up to 5 minutes until the output of a successful simulation
will yield like this:</p>
<p>(ModelSim Starter edition will take already a very long time cause of design size)</p>
<div class="highlight-TEXT notranslate"><div class="highlight"><pre><span></span>...

# Core0 currently: Interrupts in total: 0x0380, Source0: 0x013E, Source1: 0xFF, Source2: 0xC0, Source3: 0x83
# Core1 currently: Interrupts in total: 0x0380, Source0: 0x0142, Source1: 0x0101, Source2: 0xC0, Source3: 0x7D
#
# Core1 finally: Interrupts in total: 0x0380, Source0: 0x0142, Source1: 0x0101, Source2: 0xC0, Source3: 0x7D
# Core1: test finished
#
# Core0 finally: Interrupts in total: 0x0380, Source0: 0x013E, Source1: 0xFF, Source2: 0xC0, Source3: 0x83
#
# Total counts finally: ActualSum: 0x0700, Actual0: 0x0280, Actual1: 0x0200, Actual2: 0x0180, Actual3: 0x0100
# Total failure count finally: FailureSum: 0x00, Failures0: 0x00, Failures1: 0x00, Failures2: 0x00, Failures3: 0x00
#
# Core0: Main test finished
#
# ** Note: test finished with no errors!!
#    Time: 773216100 ps  Iteration: 0  Instance: /tb_top_wishbone/i0_tb_simstm
# ** Note: Leaving proc Main and halt at line 195 end_proc file ../../tb/simstm/TestMainWishbone.stm
#    Time: 1000790207100 ps  Iteration: 0  Instance: /tb_top_wishbone/i1_tb_simstm
</pre></div>
</div>
<p>Then simulation can be re-run, since compilation and elaboration has already been done by the target ‘ghdl-wishbone-all’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">modelsim</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span>
</pre></div>
</div>
<p><strong>This is very useful since the SimStm (.stm) stimuli files can be changed to do a new simulation WITHOUT recompilation.</strong></p>
<p>Then simulation can be re-run with GUI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">wishbone</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">gui</span>
</pre></div>
</div>
</section>
<section id="hxs-hardware-software-interface">
<h2><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">1.8. </span>HxS - Hardware/Software interface</a><a class="headerlink" href="#hxs-hardware-software-interface" title="Link to this heading">¶</a></h2>
<p>The Hardware/Software interface description of the Interrupt-Collector generated by HxS is: <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/src-gen/rst/Eccelerators.Library.IP.InterruptCollectorIfc-composite.rst">file</a>.</p>
<p>The respective HxS sources are found in the <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/hxs">hxs</a>  folder of the interrupt-collector clone.</p>
<p>Further generated artifacts Vhdl, SimStm, C, Python, HTML-Documentation, and PDF-Documentation is placed in <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/src-gen">hxs artifacts</a>  folder.</p>
<p>The same applies for the Interrupt-Generator of the Mock and can be found the respective submodule folder.</p>
<p>A glance at the HxS source snippet of the Interrupt Request Register:</p>
<figure class="align-default" id="id14">
<img alt="_images/HxsRegisterSnippet.png" src="_images/HxsRegisterSnippet.png" />
<figcaption>
<p><span class="caption-text">HxS Interrupt Request Register Snippet</span><a class="headerlink" href="#id14" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Then HxS artifacts can be generated by calling the following ANT target. A precondition for this step is having installed the <a class="reference external" href="https://eccelerators.com/HxS">HxS Tool</a> and Python, see  <a class="reference internal" href="#python"><span class="std std-ref">Python</span></a>.
However since the artifacts are already present, since they are unusually under version control in this repository too, it is not necessary to have the tool to run the simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">ant</span> <span class="n">hxs</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>The target calls further targets in different levels of the complete workflow:</p>
<ol class="arabic">
<li><ul>
<li><p>hxs-vhdl to generate the vhdl files in the src-gen/vhdl folder referenced by the user code files in the src/vhdl folder.</p></li>
<li><p>hxs-hxs2c to generate the C-header files in the src-gen/c folder.</p></li>
<li><p>hxs-hxs2python to generate the Python class files in the src-gen/python folder.</p></li>
<li><p>hxs-hxs2simstm to generate the SimStm files in the src-gen/simstm folder included by the testbench.</p></li>
<li><div class="line-block">
<div class="line">hxs-hxs2rst to generate the restructured text files in the src-gen/rst folder referenced by the user code files in the src/rst folder.</div>
<div class="line">A ‘.drawio’ drawing <a class="reference external" href="https://www.drawio.com">draw.io</a> is generated there, waiting to be included in documentation by the user</div>
<div class="line">or used for presentations.</div>
<div class="line">A preliminary ‘.docx’ Microsoft Word is generated there, if enabled by annotation in the HxS source. The user restructured text entered in</div>
<div class="line">HxS descriptions is not yet transformed but flows through as it is, it will be presented in following realses of HxS.</div>
</div>
</li>
</ul>
</li>
<li><ul>
<li><div class="line-block">
<div class="line">hxs-rst2html-sphinx to generate a final Sphinx style HTML document in src-gen/html-sphinx</div>
<div class="line">The composition of the resulting document is determined by user source code in the folder src/rst.The generated</div>
<div class="line">files are included there to determine the place where they are located in the final user document with e.g., additional user sections.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">hxs-rst2docbook to generate the necessary interim input files for further <a class="reference external" href="https://docbook.org">DocBook</a> transformations .</div>
<div class="line">The composition of the resulting document by further steps is determined by user source code in the folder src/docbook. The generated</div>
<div class="line">files are included there to determine the place where they are located in the final user document with e.g., additional user sections.</div>
<div class="line">Resources like the company logo can be adapted there. For further customization hints see <a class="reference internal" href="#docbook-customizations"><span class="std std-ref">DocBook customizations</span></a> section.</div>
</div>
</li>
</ul>
</li>
<li><ul>
<li><p>hxs-docbook2pdf to generate the final PDF document im src-gen/docbook-pdf</p></li>
<li><div class="line-block">
<div class="line">hxs-docbook2html to generate a final HTML document im src-gen/docbook-html</div>
<div class="line">This html output is an alternative to the Sphinx html, it is much closer to the form of the PDF output.</div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="docbook-customizations">
<span id="id5"></span><h2><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">1.9. </span>DocBook customizations</a><a class="headerlink" href="#docbook-customizations" title="Link to this heading">¶</a></h2>
<p>The docbook tranformation is done by the submodule <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/submodules/eccelerators-docbook">eccelerators-docbook</a>.
Further customizations can be done by taking this as a base for a own ‘user-docbook’ submodule. The adaptions are to be done in the folder
<a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/submodules/submodules/eccelerators-docbook/customization/resources/docbook-xsl-ns/customization">customization</a>
similar to the eccelerators-book found there in our submodule. Detailed explanations can be found at <a class="reference external" href="https://docbook.org">DocBook</a>.</p>
</section>
<section id="further-steps">
<h2><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">1.10. </span>Further steps</a><a class="headerlink" href="#further-steps" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Simply use it for your design.</p></li>
<li><p>Have a template for Eclipse and VsCode to easily enter the Mask, Request and Service bits with common name stem.</p></li>
<li><div class="line-block">
<div class="line">Adapt <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/tb/hdl/simstm_src_to_customize/tb_signals_pkg.vhd">tb_signals_pkg.vhd</a></div>
<div class="line">to different interrupt priority schemes or nested interrupts.</div>
<div class="line">Extend SimStm code with respective test cases.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Adapt <a class="reference external" href="https://github.com/eccelerators/interrupt-collector/tree/main/submodules/interrupt-dispatcher/src/vhdl/InterruptDispatcher.vhd">InterruptDispatcher.vhd</a></div>
<div class="line">to respect disabled interrupts in a core or a core already busy with an interrupt in dispatachin scheme.</div>
<div class="line">Extend SimStm code with respective test cases.</div>
</div>
</li>
<li><p>Model more cores and user specific behaviour</p></li>
</ul>
</section>
<section id="install-ghdl-ubuntu-22-04">
<span id="id7"></span><h2><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">1.11. </span>Install GHDL Ubuntu 22.04</a><a class="headerlink" href="#install-ghdl-ubuntu-22-04" title="Link to this heading">¶</a></h2>
<p>Install it by downloading:</p>
<p><a class="reference external" href="https://github.com/ghdl/ghdl/releases/tag/v4.0.0/ghdl-gha-ubuntu-22.04-llvm.tgz">https://github.com/ghdl/ghdl/releases/tag/v4.0.0/ghdl-gha-ubuntu-22.04-llvm.tgz</a>.</p>
<p>Copy the downloaded file to the a local folder e.g, ‘ghdl_download’ and unpack it there e.g., with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">ghdl_download</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">ghdl</span><span class="o">-</span><span class="n">gha</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">22.04</span><span class="o">-</span><span class="n">llvm</span><span class="o">.</span><span class="n">tgz</span> <span class="o">-</span><span class="n">C</span> <span class="o">./</span><span class="n">usr</span>
</pre></div>
</div>
<p>It is sufficient to copy the contents of the subfolders of the unpacked user folder to their respective pendants in
the system root ‘/usr’ after their owner has been set to root.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">root</span><span class="p">:</span><span class="n">root</span> <span class="o">./</span><span class="n">usr</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span>
</pre></div>
</div>
<p>Then issuing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ghdl</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>should show:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GHDL</span> <span class="mf">4.0.0</span> <span class="p">(</span><span class="mf">3.0.0</span><span class="o">.</span><span class="n">r912</span><span class="o">.</span><span class="n">gc0e7e1483</span><span class="p">)</span> <span class="p">[</span><span class="n">Dunoon</span> <span class="n">edition</span><span class="p">]</span>
 <span class="n">Compiled</span> <span class="k">with</span> <span class="n">GNAT</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">10.5.0</span>
 <span class="n">llvm</span> <span class="mf">14.0.0</span> <span class="n">code</span> <span class="n">generator</span>
<span class="n">Written</span> <span class="n">by</span> <span class="n">Tristan</span> <span class="n">Gingold</span><span class="o">.</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2003</span> <span class="o">-</span> <span class="mi">2024</span> <span class="n">Tristan</span> <span class="n">Gingold</span><span class="o">.</span>
<span class="n">GHDL</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">,</span> <span class="n">covered</span> <span class="n">by</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span><span class="o">.</span>  <span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span>
<span class="n">warranty</span><span class="p">;</span> <span class="ow">not</span> <span class="n">even</span> <span class="k">for</span> <span class="n">MERCHANTABILITY</span> <span class="ow">or</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span><span class="o">.</span>
</pre></div>
</div>
<p>It may complain about missing libraries, then install them with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">llvm</span><span class="o">-</span><span class="mi">14</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">gnat</span>
</pre></div>
</div>
<p>Install ‘gtkwave’ to use the GUI variant for simulation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">gtkwave</span>
</pre></div>
</div>
</section>
<section id="install-ghdl-windows">
<span id="id8"></span><h2><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">1.12. </span>Install GHDL Windows</a><a class="headerlink" href="#install-ghdl-windows" title="Link to this heading">¶</a></h2>
<p>There are many options beneath the following, we describe the MSYS way.</p>
<p>MSYS2 is required, install it by downloading:</p>
<p><a class="reference external" href="https://github.com/msys2/msys2-installer/releases/download/2024-01-13/msys2-x86_64-20240113.exe">MSYS2</a></p>
<p>Add <code class="docutils literal notranslate"><span class="pre">C:\msys64\ucrt64\bin</span></code> to your environment path variable.</p>
<p>Download GHDL:</p>
<p><a class="reference external" href="https://github.com/ghdl/ghdl/releases/download/v4.0.0/mingw-w64-ucrt-x86_64-ghdl-llvm-ci-1-any.pkg.tar.zst">GHDL</a></p>
<p>Execute in the ‘MSYS2 MSYS’ console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">user</span><span class="o">&gt;/</span><span class="n">Downloads</span>
<span class="n">pacman</span> <span class="o">-</span><span class="n">U</span> <span class="n">mingw</span><span class="o">-</span><span class="n">w64</span><span class="o">-</span><span class="n">ucrt</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">ghdl</span><span class="o">-</span><span class="n">llvm</span><span class="o">-</span><span class="n">ci</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">pkg</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">zst</span>
</pre></div>
</div>
<p>Then issuing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ghdl</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>should show:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GHDL</span> <span class="mf">4.0.0</span> <span class="p">(</span><span class="mf">3.0.0</span><span class="o">.</span><span class="n">r912</span><span class="o">.</span><span class="n">gc0e7e1483</span><span class="p">)</span> <span class="p">[</span><span class="n">Dunoon</span> <span class="n">edition</span><span class="p">]</span>
 <span class="n">Compiled</span> <span class="k">with</span> <span class="n">GNAT</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">10.5.0</span>
 <span class="n">llvm</span> <span class="mf">14.0.0</span> <span class="n">code</span> <span class="n">generator</span>
<span class="n">Written</span> <span class="n">by</span> <span class="n">Tristan</span> <span class="n">Gingold</span><span class="o">.</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2003</span> <span class="o">-</span> <span class="mi">2024</span> <span class="n">Tristan</span> <span class="n">Gingold</span><span class="o">.</span>
<span class="n">GHDL</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">,</span> <span class="n">covered</span> <span class="n">by</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span><span class="o">.</span>  <span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span>
<span class="n">warranty</span><span class="p">;</span> <span class="ow">not</span> <span class="n">even</span> <span class="k">for</span> <span class="n">MERCHANTABILITY</span> <span class="ow">or</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span><span class="o">.</span>
</pre></div>
</div>
<p>Install ‘gtkwave’ to use the GUI variant for simulation in the ‘MSYS2 MSYS’ console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">mingw</span><span class="o">-</span><span class="n">w64</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">gtkwave</span>
</pre></div>
</div>
</section>
<section id="python">
<span id="id9"></span><h2><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">1.13. </span>Python</a><a class="headerlink" href="#python" title="Link to this heading">¶</a></h2>
<p>Python must be present to run the helper- and hxs- generator targets of the ANT build file.
To get all necessary dependencies you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">git</span><span class="o">/</span><span class="n">interrupt</span><span class="o">-</span><span class="n">collector</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section id="adapt-ant-build">
<span id="id10"></span><h2><a class="toc-backref" href="#id29" role="doc-backlink"><span class="section-number">1.14. </span>Adapt ANT build</a><a class="headerlink" href="#adapt-ant-build" title="Link to this heading">¶</a></h2>
<p>If it is present its path can be adapted in the top ‘build.xml’ file in the repository root once for all builds and child builds.
Especially the pathes to the python , ghdl and modelsim executables usually have to be adapted for windows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``&lt;!-- properties for local purposes, should be overriden by ci ant call e.g,        ``
``     with -Dpython-executable argument for ci purposes                             ``
``                                                                                   ``
``defaults :                                                                         ``
``                                                                                   ``
``&lt;property name=&quot;ghdl-executable&quot; value=&quot;ghdl&quot;/&gt;                                    ``
``&lt;property name=&quot;gtkwave-executable&quot; value=&quot;gtkwave&quot;/&gt;                              ``
``                                                                                   ``
``&lt;property name=&quot;vlib-executable&quot; value=&quot;vlib&quot;/&gt;                                    ``
``&lt;property name=&quot;vmap-executable&quot; value=&quot;vmap&quot;/&gt;                                    ``
``&lt;property name=&quot;vcom-executable&quot; value=&quot;vcom&quot;/&gt;                                    ``
``&lt;property name=&quot;vsim-executable&quot; value=&quot;vsim&quot;/&gt;                                        ``
``                                                                                   ``
``override respectively by uncommenting e.g, for python the following line:          ``
``--&gt;                                                                                ``
``&lt;!-- &lt;property name=&quot;python-executable&quot;                                            ``
``      value=&quot;C:Users\user\AppData\Local\Programs\Python\Python38\python.exe&quot;/&gt; --&gt;  ``
</pre></div>
</div>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Welcome to InterruptCollector’s documentation!</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Eccelerators.Library.IP.InterruptCollectorIfc-composite.html"><span class="section-number">2. </span>Interrupt Collector Interface (InterruptCollectorIfc)</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, Eccelerators GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.2.
    </div>
  </body>
</html>